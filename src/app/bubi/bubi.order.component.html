<p-toast></p-toast>

<div class="jumbotron">
  <h1>{{"bubi.invoice" | translate}}</h1>
  <p>{{"bubi.invoice.short" | translate}}</p>
</div>

<p-dialog *ngIf="bubiService.activeCoredata" header="Stammdaten bearbeiten" [(visible)]="showPaymentDialog" [responsive]="true"
          [style]="{width: '75vw', height: '90vh'}" [modal]="true">
  <h4>{{"bubi.coredata.for.item" | translate}}</h4>
  <div class="p-fluid p-formgrid p-grid">
    <div class="p-field p-col">
      <label for="isInvoiceComplete">{{"is.invoice.complete" | translate}}</label>
      <p-checkbox id="isInvoiceComplete" [(ngModel)]="isInvoiceComplete" [binary]="true"></p-checkbox>
    </div>
    <div class="p-field p-col">
      <label for="invoice_amount">{{"bubi.invoice.amount" | translate}}</label>
      <input id="invoice_amount" type="text" pInputText [(ngModel)]="invoiceAmount"/>
    </div>
    <p *ngIf="!(invoiceAmount === bubiService.activeBubiOrder.totalAmount)">{{'bubi.invoice.amount.not.agree' | translate}}</p>
    <button pButton type="button" icon="fa-save" label="Bezahlen"
            (click)="payActiveBubiOrder()"></button>
  </div>
</p-dialog>

<div id="editor">
  <div class="tile">
    <h2 style="height:1.2em;">{{"bubi.order.line.new" | translate}}</h2>
    <p>{{"bubi.order.line.new.short" | translate}}</p>
    <h4>{{"bubi.order.line.new.from.collection" | translate}}</h4>
    <p-table #dt1 [value]="bubiOrders" dataKey="bubiOrderId"
    [rows]="10" [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [loading]="loading"
    styleClass="p-datatable-customers p-datatable-gridlines"
    [paginator]="true"
    currentPageReportTemplate="Zeige {first} bis {last} aller {totalRecords} Einträge"
    [globalFilterFields]="['collection','shelfmark','fund','title', 'minting', 'vendorId']">
    <ng-template pTemplate="caption">
      <div class="p-grid">
        <div class="p-col-2">
          <span class="p-input-icon-left p-ml-auto">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="dt1.filterGlobal($event.target.value, 'contains')"
                           placeholder="Globale Suche"/>
                </span>
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th>
          <div class="p-d-flex p-jc-between p-ai-center">
            Auftrag
          </div>
        </th>
        <th>
          <div class="p-d-flex p-jc-between p-ai-center">
            Alma-Bestellnummer
          </div>
        </th>
        <th>
          <div class="p-d-flex p-jc-between p-ai-center">
            Vom
          </div>
        </th>
        <th>
          <div class="p-d-flex p-jc-between p-ai-center">
            Buchbinder
            <p-columnFilter type="text" field="vendorId" display="menu"></p-columnFilter>
          </div>
        </th>
        <th>
          <div class="p-d-flex p-jc-between p-ai-center">
            Status
            <p-columnFilter type="text" field="status" display="menu"></p-columnFilter>
          </div>
        </th>
        <th>
          <div class="p-d-flex p-jc-between p-ai-center">
            Datum Abholung
          </div>
        </th>
        <th>
          <div class="p-d-flex p-jc-between p-ai-center">
            Datum zurück
          </div>
        </th>
        <th>
          <div class="p-d-flex p-jc-between p-ai-center">
            Bezahl-Status
            <p-columnFilter type="text" field="status" display="menu"></p-columnFilter>
          </div>
        </th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-order>
      <tr>
        <td>
          {{order.bubiOrderId}}
        </td>
        <td>
          {{order.almaOrderId}}
        </td>
        <td>
          {{order.created}}
        </td>
        <td>
          {{order.vendorId}}
        </td>
        <td>
          {{order.status}}
        </td>
        <td>
          <p-calendar [(ngModel)]="order.collectedOn"></p-calendar>
        </td>
        <td>
          <p-calendar [(ngModel)]="order.returnedOn"></p-calendar>
        </td>
        <td>
          {{order.paymentStatus}}
        </td>
        <td>
          <button pButton type="button" (click)="confirmPayment(order)" label="Rechnungen anlegen"></button>
          <button pButton type="button" (click)="payBubiOrder()" label="Eingetroffen"></button>
          <button pButton type="button" (click)="payBubiOrder()" label="Eingetroffen und Rechnungen anlegen"></button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7">No customers found.</td>
      </tr>
    </ng-template>
    </p-table>
  </div>
</div>
<div class="p-grid">
  <div class="p-col-10 p-offset-1">
    <div class="tile centered">
      <button [routerLink]="['/bubi/start']" pButton type="button" [label]="'back' | translate"
              class="btn btn-primary"></button>
    </div>
  </div>
</div>
